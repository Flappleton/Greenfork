<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Surprise Meal App</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.7.1/dist/leaflet.css" />
    <script src="https://unpkg.com/leaflet@1.7.1/dist/leaflet.js"></script>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">

    <style>
        /* ===== RESET AND BASE STYLES ===== */
        *, *::before, *::after {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        :root {
            /* Color variables */
            --color-primary: #0ea5e9;
            --color-primary-dark: #0284c7;
            --color-primary-light: #e0f2fe;
            --color-secondary: #f97316;
            --color-secondary-dark: #ea580c;
            --color-success: #22c55e;
            --color-danger: #ef4444;
            --color-warning: #f59e0b;
            --color-gray-50: #f9fafb;
            --color-gray-100: #f3f4f6;
            --color-gray-200: #e5e7eb;
            --color-gray-300: #d1d5db;
            --color-gray-400: #9ca3af;
            --color-gray-500: #6b7280;
            --color-gray-600: #4b5563;
            --color-gray-700: #374151;
            --color-gray-800: #1f2937;
            --color-gray-900: #111827;
            --color-white: #ffffff;

            /* Shadow variables */
            --shadow-sm: 0 1px 2px 0 rgba(0, 0, 0, 0.05);
            --shadow-md: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
            --shadow-lg: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);

            /* Border radius */
            --radius-sm: 0.25rem;
            --radius-md: 0.375rem;
            --radius-lg: 0.5rem;
            --radius-full: 9999px;

            /* Spacing */
            --spacing-1: 0.25rem;
            --spacing-2: 0.5rem;
            --spacing-3: 0.75rem;
            --spacing-4: 1rem;
            --spacing-5: 1.25rem;
            --spacing-6: 1.5rem;
            --spacing-8: 2rem;
            --spacing-10: 2.5rem;
            --spacing-12: 3rem;
            --spacing-16: 4rem;
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;
            /* background-color: var(--color-gray-50); */
            background-color: #2a9d8f;
            color: var(--color-gray-900);
            line-height: 1.5;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
        }

        /* ===== LAYOUT ===== */
        .container {
            width: 100%;
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 var(--spacing-4);
        }

        .py-6 {
            padding-top: var(--spacing-6);
            padding-bottom: var(--spacing-6);
        }

        .mb-2 {
            margin-bottom: var(--spacing-2);
        }

        .mb-3 {
            margin-bottom: var(--spacing-3);
        }

        .mb-4 {
            margin-bottom: var(--spacing-4);
        }

        .mb-6 {
            margin-bottom: var(--spacing-6);
        }

        .mt-1 {
            margin-top: var(--spacing-1);
        }

        .mt-2 {
            margin-top: var(--spacing-2);
        }

        .mr-1 {
            margin-right: var(--spacing-1);
        }

        .mr-2 {
            margin-right: var(--spacing-2);
        }

        .ml-1 {
            margin-left: var(--spacing-1);
        }

        .ml-2 {
            margin-left: var(--spacing-2);
        }

        .p-4 {
            padding: var(--spacing-4);
        }

        .pt-0 {
            padding-top: 0;
        }

        .pl-9 {
            padding-left: 2.25rem;
        }

        .h-16 {
            height: 4rem;
        }

        .h-40 {
            height: 10rem;
        }

        .w-full {
            width: 100%;
        }

        .flex {
            display: flex;
        }

        .flex-1 {
            flex: 1 1 0%;
        }

        .flex-col {
            flex-direction: column;
        }

        .items-center {
            align-items: center;
        }

        .items-start {
            align-items: flex-start;
        }

        .justify-between {
            justify-content: space-between;
        }

        .gap-1 {
            gap: var(--spacing-1);
        }

        .gap-2 {
            gap: var(--spacing-2);
        }

        .gap-4 {
            gap: var(--spacing-4);
        }

        .grid {
            display: grid;
        }

        .grid-cols-1 {
            grid-template-columns: repeat(1, minmax(0, 1fr));
        }

        .relative {
            position: relative;
        }

        .absolute {
            position: absolute;
        }

        .top-2 {
            top: var(--spacing-2);
        }

        .right-2 {
            right: var(--spacing-2);
        }

        .left-2 {
            left: var(--spacing-2);
        }

        .left-3 {
            left: var(--spacing-3);
        }

        .top-1\/2 {
            top: 50%;
        }

        .-translate-y-1\/2 {
            transform: translateY(-50%);
        }

        .hidden {
            display: none;
        }

        .text-right {
            text-align: right;
        }

        /* ===== TYPOGRAPHY ===== */
        .text-xs {
            font-size: 0.75rem;
            line-height: 1rem;
        }

        .text-sm {
            font-size: 0.875rem;
            line-height: 1.25rem;
        }

        .text-lg {
            font-size: 1.125rem;
            line-height: 1.75rem;
        }

        .text-xl {
            font-size: 1.25rem;
            line-height: 1.75rem;
        }

        .text-2xl {
            font-size: 1.5rem;
            line-height: 2rem;
            border: #111827 3px solid;
            border-radius: var(--radius-md);
            text-align: center;
            color: var(b--color-white);
            background-color: var(--color-primary-dark);
            padding: var(--spacing-2) var(--spacing-4);
            padding: 0.5rem;
            background-color: #13ccb7;
            display: flex;
            align-items: center;
            gap: var(--spacing-2);
        }

        .text-2xl::before {
            content: '\f290'; /* Unicode for Font Awesome bag icon */
            font-family: 'Font Awesome 6 Free';
            font-weight: 900;
            margin-right: var(--spacing-2);
        }

        .font-medium {
            font-weight: 500;
        }

        .font-semibold {
            font-weight: 600;
        }

        .font-bold {
            font-weight: 700;
        }

        .line-through {
            text-decoration: line-through;
        }

        .text-primary {
            color: var(--color-primary);
        }

        .text-white {
            color: var(--color-white);
        }

        .text-muted {
            color: var(--color-gray-500);
        }

        .line-clamp-2 {
            display: -webkit-box;
            -webkit-line-clamp: 2;
            line-clamp: 2;
            -webkit-box-orient: vertical;
            overflow: hidden;
        }

        /* ===== COMPONENTS ===== */
        /* Card */
        .card {
            background-color: var(--color-white);
            border-radius: var(--radius-lg);
            box-shadow: var(--shadow-md);
            overflow: hidden;
            transition: transform 0.2s ease, box-shadow 0.2s ease;
        }

        .card:hover {
            transform: translateY(-4px);
            box-shadow: var(--shadow-lg);
        }

        .card-content {
            padding: var(--spacing-4);
        }

        .card-footer {
            padding: var(--spacing-4);
            padding-top: 0;
        }

        /* Badge */
        .badge {
            display: inline-flex;
            align-items: center;
            border-radius: var(--radius-full);
            padding: 0 var(--spacing-2);
            height: 1.5rem;
            font-size: 0.75rem;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }

        .badge-success {
            background-color: var(--color-success);
            color: var(--color-white);
        }

        .badge-danger {
            background-color: var(--color-danger);
            color: var(--color-white);
        }

        .badge-warning {
            background-color: var(--color-warning);
            color: var(--color-white);
        }

        /* Button */
        .btn {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            border-radius: var(--radius-md);
            padding: 0 var(--spacing-4);
            height: 2.5rem;
            font-size: 0.875rem;
            font-weight: 500;
            transition: all 0.2s ease;
            cursor: pointer;
            border: none;
            outline: none;
        }

        .btn:disabled {
            opacity: 0.7;
            cursor: not-allowed;
        }

        .btn-primary {
            background-color: var(--color-primary);
            color: var(--color-white);
        }

        .btn-primary:hover:not(:disabled) {
            background-color: var(--color-primary-dark);
        }

        .btn-outline {
            background-color: transparent;
            border: 1px solid var(--color-gray-300);
            color: var(--color-gray-700);
        }

        .btn-outline:hover:not(:disabled) {
            background-color: var(--color-gray-100);
        }

        .btn-icon {
            width: 2.5rem;
            padding: 0;
        }

        /* Input */
        .input {
            height: 2.5rem;
            width: 100%;
            border-radius: var(--radius-md);
            border: 1px solid var(--color-gray-300);
            background-color: var(--color-white);
            padding: 0 var(--spacing-3);
            font-size: 0.875rem;
            transition: border-color 0.2s ease;
        }

        .input:focus {
            outline: none;
            border-color: var(--color-primary);
            box-shadow: 0 0 0 2px var(--color-primary-light);
        }

        .input::placeholder {
            color: var(--color-gray-400);
        }

        /* Food image placeholder */
        .food-image-placeholder {
            width: 100%;
            height: 10rem;
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--color-white);
            font-weight: 600;
            background-size: cover;
            background-position: center;
        }

        #map {
            height: 400px;
            width: 100%;
            display: none; /* Initially hide the map */
            margin-top: 20px;
        }

        .map-visible {
            display: block !important;
        }

        /* ===== RESPONSIVE STYLES ===== */
        @media (min-width: 768px) {
            .grid-cols-1 {
                grid-template-columns: repeat(2, minmax(0, 1fr));
            }
        }

        @media (min-width: 1024px) {
            .grid-cols-1 {
                grid-template-columns: repeat(3, minmax(0, 1fr));
            }
        }

        /* Navbar styles from merchant.html */
        .navbar { background: white; box-shadow: 0 2px 10px rgba(0,0,0,0.05); padding: 1rem 0; }
        .nav-link { color: #2a9d8f !important; font-weight: 500; transition: color 0.3s; margin: 0 0.5rem;}
        .nav-link:hover, .nav-link.active { color: #8ab17d !important; }
        .navbar-brand img { transition: transform 0.3s; height: 55px; }
        .navbar-brand img:hover { transform: scale(1.05); }

        /* Footer styles from merchant.html */
        footer { background: #264653; color: white; padding: 3rem 0 2rem; margin-top: 4rem; }
    </style>
</head>
<body>
    <!-- Navigation from merchant.html -->
    <nav class="navbar navbar-expand-lg navbar-light">
        <div class="container">
            <a class="navbar-brand" href="index.html">
                <img src="logo.png" alt="GreenFork Logo">
            </a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarNav">
                <!-- NAV ITEMS UPDATED WITH IDs FOR AUTH SCRIPT -->
                <ul class="navbar-nav ms-auto">
                    <li class="nav-item"><a class="nav-link" href="index.html">Home</a></li>
                    <li class="nav-item"><a class="nav-link" href="index.html#about-us">About</a></li>
                    <li class="nav-item"><a class="nav-link" href="merchant.html">Merchants</a></li>
                    <li class="nav-item"><a class="nav-link active" href="seeker.html">Seekers</a></li>
                    <li class="nav-item"><a class="nav-link" href="compost.html">Compost</a></li>
                    <!-- Auth Links -->
                    <li class="nav-item" id="signInLi">
                        <a class="nav-link" href="#" data-bs-toggle="modal" data-bs-target="#signInModal">Sign In</a>
                    </li>
                    <li class="nav-item" id="signUpLi">
                        <a class="nav-link" href="#" data-bs-toggle="modal" data-bs-target="#signUpModal">Sign Up</a>
                    </li>
                    <li class="nav-item d-none" id="logoutLi"> <!-- Initially hidden -->
                        <a class="nav-link" href="#" id="logoutLink">Logout</a>
                    </li>
                    <li class="nav-item d-none" id="profileLi"> <!-- Initially hidden -->
                        <a class="nav-link" href="#" id="profileLink">My Profile</a>
                    </li>
                </ul>
            </div>
        </div>
    </nav>

    <div class="container py-6">
        <header class="mb-6">
            <div class="flex items-center justify-between mb-4">
                <div>
                </div>
                <h1 class="text-2xl font-bold">Surprise Bags</h1>
                <button id="map-button" class="btn btn-outline btn-icon">
                    <i class="fas fa-map-marker-alt"></i>
                </button>
            </div>

            <div class="flex gap-2">
                <div class="relative flex-1">
                    <i class="fas fa-search absolute left-3 top-1/2 -translate-y-1/2 text-muted"></i>
                    <input type="text" placeholder="        Search stores" class="input pl-9">
                </div>
                <button class="btn btn-outline btn-icon">
                    <i class="fas fa-filter"></i>
                </button>
            </div>
        </header>

        <section id="food-bag-list" class="grid grid-cols-1 gap-4">
        </section>

        <div id="map"></div>

        <div class="h-16"></div>
    </div>

    <!-- Footer from merchant.html -->
    <footer>
        <div class="container text-center">
            <p class="mb-0">Â© 2025 GreenFork. All rights reserved.</p>
        </div>
    </footer>

    <!-- Sign In Modal from merchant.html -->
    <div class="modal fade" id="signInModal" tabindex="-1" aria-labelledby="signInModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header" style="background: #2a9d8f; color: white; border-bottom: none; border-radius: 10px 10px 0 0;">
                    <h5 class="modal-title" id="signInModalLabel">Sign In</h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <form id="signInForm">
                        <div class="mb-3">
                            <label for="signInEmail" class="form-label">Email address</label>
                            <input type="email" class="form-control" id="signInEmail" placeholder="Email" required>
                        </div>
                        <div class="mb-3">
                            <label for="signInPassword" class="form-label">Password</label>
                            <input type="password" class="form-control" id="signInPassword" placeholder="Password" required>
                        </div>
                        <div class="mb-3" id="signInError"></div>
                        <div class="d-grid">
                            <button type="submit" class="btn" style="background: #2a9d8f; color: white; border-radius: 20px;">Sign In</button>
                        </div>
                    </form>
                    <div class="text-center mt-3">
                        <p>New to GreenFork?
                           <a href="#" data-bs-toggle="modal" data-bs-target="#signUpModal" data-bs-dismiss="modal" style="color: #2a9d8f;">Create an account</a>
                        </p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Sign Up Modal from merchant.html -->
    <div class="modal fade" id="signUpModal" tabindex="-1" aria-labelledby="signUpModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header" style="background: #2a9d8f; color: white; border-bottom: none; border-radius: 10px 10px 0 0;">
                    <h5 class="modal-title" id="signUpModalLabel">Create Account</h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <form id="signUpForm">
                        <div class="mb-3">
                            <label for="signUpName" class="form-label">Full Name</label>
                            <input type="text" class="form-control" id="signUpName" placeholder="Your Name" required>
                        </div>
                        <div class="mb-3">
                            <label for="signUpAccountType" class="form-label">I am a...</label>
                            <select class="form-select" id="signUpAccountType" required>
                                <option value="" disabled selected>Select Account Type</option>
                                <option value="Merchant">Merchant (Donor)</option>
                                <option value="Seeker">Seeker (Recipient)</option>
                            </select>
                        </div>
                        <div class="mb-3">
                            <label for="signUpEmail" class="form-label">Email address</label>
                            <input type="email" class="form-control" id="signUpEmail" placeholder="name@example.com" required>
                        </div>
                        <div class="mb-3">
                            <label for="signUpPassword" class="form-label">Password</label>
                            <input type="password" class="form-control" id="signUpPassword" placeholder="Min. 6 characters" required>
                        </div>
                        <div class="mb-3" id="signUpError"></div>
                        <div class="d-grid">
                            <button type="submit" class="btn" style="background: #2a9d8f; color: white; border-radius: 20px;">Create Account</button>
                        </div>
                    </form>
                    <div class="text-center mt-3">
                        <p>Already have an account?
                            <a href="#" data-bs-toggle="modal" data-bs-target="#signInModal" data-bs-dismiss="modal" style="color: #2a9d8f;">Sign In</a>
                        </p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- SCRIPTS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-authÂ W.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-firestore.js"></script>
    <!-- Firebase Init -->
    <script src="js/firebase-init.js"></script>
    <!-- Firebase Auth Logic -->
    <script src="js/auth.js"></script>

    <template id="food-bag-card-template">
        <div class="card">
            <div class="relative">
                <div class="food-image-placeholder">
                    <span class="store-emoji"></span>
                </div>
                <span class="badge badge-success absolute top-2 right-2 discount-badge">Save 0%</span>
                <span class="badge badge-danger absolute top-2 left-2 quantity-badge hidden">Only 0 left!</span>
            </div>

            <div class="card-content">
                <div class="flex justify-between items-start mb-2">
                    <h3 class="font-bold text-lg store-name"></h3>

                    <div class="flex items-center gap-1 text-sm text-muted">
                        <i class="fas fa-users"></i>
                        <span class="servings">Feeds 0</span>
                    </div>
                </div>

                <p class="text-sm text-muted mb-2 line-clamp-2 description"></p>

                <div class="flex justify-between items-center">
                    <div>
                        <p class="text-sm text-muted pickup-time"></p>
                        <p class="text-sm text-muted distance"></p>
                    </div>

                    <div class="text-right">
                        <p class="text-sm line-through text-muted original-price">â‚¹0</p>
                        <p class="font-bold text-lg discount-price">â‚¹0</p>
                    </div>
                </div>
            </div>

            <div class="card-footer">
                <button class="btn btn-primary w-full reserve-btn">
                    Add to Cart
                </button>
            </div>
        </div>
    </template>

    <script>
        // ===== MOCK DATA =====
        // This is the data for the surprise bags
        // In a real app, you would fetch this from an API
        const surpriseBags = [
            {
                id: 1,
                storeName: "Fresh Bakery",
                description: "Assorted pastries and bread including croissants, pain au chocolat, and sourdough bread.",
                originalPrice: 1999, // Original price in rupees
                discountPrice: 699,  // Discounted price in rupees
                servings: 3,        // Number of people the bag can feed
                pickupTime: "Today, 17:00 - 18:00",
                distance: "1.2 km",
                color: "#FF9F1C",    // Background color for the placeholder
                emoji: "ðŸ¥",        // Emoji representing the food type
                quantity: 5,        // Number of bags available
                latitude: 28.6250,
                longitude: 77.2185,
            },
            {
                id: 2,
                storeName: "Green Garden Restaurant",
                description: "Vegetarian surprise bag with fresh salads, wraps, and healthy snacks.",
                originalPrice: 2499,
                discountPrice: 899,
                servings: 2,
                pickupTime: "Today, 19:30 - 20:30",
                distance: "0.8 km",
                color: "#2EC4B6",
                emoji: "ðŸ¥—",
                quantity: 3,
                latitude: 28.6180,
                longitude: 77.2000,
            },
            {
                id: 3,
                storeName: "Pasta Paradise",
                description: "Italian food surprise with pasta, garlic bread, and tiramisu.",
                originalPrice: 3200,
                discountPrice: 1099,
                servings: 4,
                pickupTime: "Tomorrow, 12:00 - 13:00",
                distance: "2.5 km",
                color: "#E71D36",
                emoji: "ðŸ",
                quantity: 2,
                latitude: 28.6300,
                longitude: 77.2250,
            },
            {
                id: 4,
                storeName: "Sushi Station",
                description: "Assorted sushi rolls, miso soup, and edamame beans.",
                originalPrice: 2800,
                discountPrice: 999,
                servings: 2,
                pickupTime: "Today, 20:00 - 21:00",
                distance: "3.1 km",
                color: "#011627",
                emoji: "ðŸ£",
                quantity: 4,
                latitude: 28.6100,
                longitude: 77.2050,
            },
            {
                id: 5,
                storeName: "Spice of India",
                description: "Authentic Indian curry, naan bread, and rice dishes.",
                originalPrice: 2200,
                discountPrice: 799,
                servings: 3,
                pickupTime: "Today, 18:30 - 19:30",
                distance: "1.7 km",
                color: "#F71735",
                emoji: "ðŸ›",
                quantity: 1,
                latitude: 28.6200,
                longitude: 77.2100,
            },
            {
                id: 6,
                storeName: "Sweet Tooth Bakery",
                description: "Assorted desserts including cakes, cookies, and pastries.",
                originalPrice: 1800,
                discountPrice: 599,
                servings: 4,
                pickupTime: "Tomorrow, 10:00 - 11:00",
                distance: "0.5 km",
                color: "#FF9F1C",
                emoji: "ðŸ°",
                quantity: 6,
                latitude: 28.6150,
                longitude: 77.1950,
            },
        ];

        // ===== FUNCTIONS =====

        // Function to render all food bag cards
        function renderFoodBags() {
            const foodBagList = document.getElementById('food-bag-list');
            const template = document.getElementById('food-bag-card-template');

            // Clear existing content
            foodBagList.innerHTML = '';

            // Render each food bag
            surpriseBags.forEach(bag => {
                // Clone the template
                const cardClone = template.content.cloneNode(true);

                // Calculate discount percentage
                const discount = Math.round(((bag.originalPrice - bag.discountPrice) / bag.originalPrice) * 100);

                // Set the food image placeholder background and emoji
                const foodImagePlaceholder = cardClone.querySelector('.food-image-placeholder');
                foodImagePlaceholder.style.backgroundColor = bag.color;
                foodImagePlaceholder.style.fontSize = '3rem';

                // Set the content
                cardClone.querySelector('.store-emoji').textContent = bag.emoji;
                cardClone.querySelector('.discount-badge').textContent = `Save ${discount}%`;
                cardClone.querySelector('.store-name').textContent = bag.storeName;
                cardClone.querySelector('.servings').textContent = `Feeds ${bag.servings}`;
                cardClone.querySelector('.description').textContent = bag.description;
                cardClone.querySelector('.pickup-time').textContent = bag.pickupTime;
                cardClone.querySelector('.distance').textContent = `${bag.distance} away`;
                cardClone.querySelector('.original-price').textContent = `â‚¹${bag.originalPrice}`;
                cardClone.querySelector('.discount-price').textContent = `â‚¹${bag.discountPrice}`;

                // Show quantity badge if quantity is low
                if (bag.quantity <= 2) {
                    const quantityBadge = cardClone.querySelector('.quantity-badge');
                    quantityBadge.textContent = `Only ${bag.quantity} left!`;
                    quantityBadge.classList.remove('hidden');
                }

                // Add event listener to reserve button
                const reserveBtn = cardClone.querySelector('.reserve-btn');
                reserveBtn.addEventListener('click', () => {
                    reserveBtn.textContent = 'Reserving...';
                    reserveBtn.disabled = true;

                    // Simulate API call
                    setTimeout(() => {
                        // In a real app, you would redirect to a checkout page
                        alert(`Bag from ${bag.storeName} reserved successfully!`);
                        reserveBtn.textContent = 'Reserved!';
                        setTimeout(() => {
                            reserveBtn.textContent = 'Reserve Bag';
                            reserveBtn.disabled = false;
                        }, 2000);
                    }, 1000);
                });

                // Append the card to the list
                foodBagList.appendChild(cardClone);
            });
        }

        // ===== INITIALIZATION =====
        // Initialize the page when the DOM is fully loaded
        document.addEventListener('DOMContentLoaded', () => {
            renderFoodBags();

            // Add event listener to search input
            const searchInput = document.querySelector('.input');
            searchInput.addEventListener('input', (e) => {
                const searchTerm = e.target.value.toLowerCase();

                // Filter the bags based on the search term
                const filteredBags = surpriseBags.filter(bag =>
                    bag.storeName.toLowerCase().includes(searchTerm) ||
                    bag.description.toLowerCase().includes(searchTerm)
                );

                // Re-render the filtered bags
                const foodBagList = document.getElementById('food-bag-list');
                foodBagList.innerHTML = '';

                if (filteredBags.length === 0) {
                    foodBagList.innerHTML = '<div class="text-center p-4 text-muted">No results found</div>';
                    return;
                }

                // Render each filtered bag
                filteredBags.forEach(bag => {
                    // Clone the template
                    const template = document.getElementById('food-bag-card-template');
                    const cardClone = template.content.cloneNode(true);

                    // Calculate discount percentage
                    const discount = Math.round(((bag.originalPrice - bag.discountPrice) / bag.originalPrice) * 100);

                    // Set the food image placeholder background and emoji
                    const foodImagePlaceholder = cardClone.querySelector('.food-image-placeholder');
                    foodImagePlaceholder.style.backgroundColor = bag.color;
                    foodImagePlaceholder.style.fontSize = '3rem';

                    // Set the content
                    cardClone.querySelector('.store-emoji').textContent = bag.emoji;
                    cardClone.querySelector('.discount-badge').textContent = `Save ${discount}%`;
                    cardClone.querySelector('.store-name').textContent = bag.storeName;
                    cardClone.querySelector('.servings').textContent = `Feeds ${bag.servings}`;
                    cardClone.querySelector('.description').textContent = bag.description;
                    cardClone.querySelector('.pickup-time').textContent = bag.pickupTime;
                    cardClone.querySelector('.distance').textContent = `${bag.distance} away`;
                    cardClone.querySelector('.original-price').textContent = `â‚¹${bag.originalPrice}`;
                    cardClone.querySelector('.discount-price').textContent = `â‚¹${bag.discountPrice}`;

                    // Show quantity badge if quantity is low
                    if (bag.quantity <= 2) {
                        const quantityBadge = cardClone.querySelector('.quantity-badge');
                        quantityBadge.textContent = `Only ${bag.quantity} left!`;
                        quantityBadge.classList.remove('hidden');
                    }

                    // Add event listener to reserve button
                    const reserveBtn = cardClone.querySelector('.reserve-btn');
                    reserveBtn.addEventListener('click', () => {
                        reserveBtn.textContent = 'Reserving...';
                        reserveBtn.disabled = true;

                        // Simulate API call
                        setTimeout(() => {
                            // In a real app, you would redirect to a checkout page
                            alert(`Bag from ${bag.storeName} reserved successfully!`);
                            reserveBtn.textContent = 'Reserved!';
                            setTimeout(() => {
                                reserveBtn.textContent = 'Reserve Bag';
                                reserveBtn.disabled = false;
                            }, 2000);
                        });
                    });

                    // Append the card to the list
                    foodBagList.appendChild(cardClone);
                });
            });

            const mapButton = document.getElementById('map-button');
            const mapDiv = document.getElementById('map');
            let map;

            mapButton.addEventListener('click', () => {
                mapDiv.classList.toggle('map-visible');
                if (mapDiv.classList.contains('map-visible')) {
                    if (!map) {
                        map = L.map('map').setView([28.6139, 77.2090], 12);
                        L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
                            attribution: 'Â© <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'
                        }).addTo(map);
                        surpriseBags.forEach(bag => {
                            if (bag.latitude && bag.longitude) {
                                L.marker([bag.latitude, bag.longitude]).addTo(map).bindPopup(bag.storeName);
                            }
                        });
                    }
                }
            });
        });
    </script>
</body>
</html>
